// Generated by CoffeeScript 1.7.1
(function() {
  var Async, MongoDb, _mongoHost, _mongoPort, _mongoURL, _ref, _ref1, _ref2;

  MongoDb = require('mongodb');

  Async = require('async');

  _mongoHost = (_ref = process.env.OPENSHIFT_MONGODB_DB_HOST) != null ? _ref : '127.0.0.1';

  _mongoPort = (_ref1 = process.env.OPENSHIFT_MONGODB_DB_PORT) != null ? _ref1 : 27017;

  _mongoURL = (_ref2 = process.env.OPENSHIFT_MONGODB_DB_URL) != null ? _ref2 : "mongodb://127.0.0.1:27017/ringing";

  exports.collections = [];

  exports.start = function(done) {
    return MongoDb.MongoClient.connect(_mongoURL, function(err, db) {
      var collections;
      if (err != null) {
        return done("Failed to connect to MongoDB on " + _mongoURL);
      }
      collections = ['lengths', 'towers'];
      return Async.each(collections, function(collectionName, done) {
        return db.createCollection(collectionName, {
          strict: false
        }, function(err, collection) {
          exports.collections[collectionName] = collection;
          return done(err);
        });
      }, function(err) {
        if (err != null) {
          return done("Collection creation failed with error: " + err);
        }
        return exports.collections.lengths.count(function(err, count) {
          if (err != null) {
            return done("Sample DB query failed");
          }
          return done();
        });
      });
    });
  };

}).call(this);
